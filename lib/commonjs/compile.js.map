{"version":3,"sources":["compile.ts"],"names":["DEFAULT_DURATION","getKeyframeSequenceItems","definition","keyframe","previousKeyframe","keyframeStyles","properties","reduce","acc","property","value","type","duration","compile","keyframes","Object","keys","map","parsePosition","filter","notNull","length","Error","sort","compareNumbers","getDefinitionKeyframeStyles","definitionKeyframesStyles","definitionProperties","from","config","animate","i","filtredKeyframes","keyframeSequenceItems","forEach","sequenceItem","flat","delay","result","transition","repeat","easing","style","cache","Map","compileAnimation","cachedBuilder","get","builder","set"],"mappings":"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","sourcesContent":["import { MotifiableDefinition, MotifiableBuilder, StyleValues, MotifiableProps } from './types'\nimport { compareNumbers, getKeyframesStylesProperties, getKeyframeStyles, getKeyframeStylesProperties, notNull, parsePosition } from './utils'\n\nconst DEFAULT_DURATION = 1000\n\nconst getKeyframeSequenceItems = (\n  definition: MotifiableDefinition,\n  keyframe: number,\n  previousKeyframe: number): Partial<Record<keyof StyleValues, Record<string, any>>> => {\n  const keyframeStyles = getKeyframeStyles(definition)(keyframe)\n\n  const properties = getKeyframeStylesProperties(keyframeStyles)\n\n  return properties.reduce((acc, property) => {\n    return {\n      ...acc,\n      [property]: {\n        value: keyframeStyles[property],\n        type: 'timing',\n        duration: keyframe - previousKeyframe\n      }\n    }\n  }, {})\n}\n\nconst compile = (definition: MotifiableDefinition): MotifiableBuilder => {\n  const keyframes = Object.keys(definition)\n    .map(parsePosition)\n    .filter(notNull) as number[]\n\n  if (keyframes.length < 2) {\n    throw new Error('Animation definitions must have at least two values.')\n  }\n\n  keyframes.sort(compareNumbers)\n\n  const getDefinitionKeyframeStyles = getKeyframeStyles(definition)\n\n  const definitionKeyframesStyles = keyframes.map(getDefinitionKeyframeStyles)\n  const definitionProperties = getKeyframesStylesProperties(definitionKeyframesStyles)\n\n  const from = getDefinitionKeyframeStyles(0) as MotifiableProps['from']\n\n  return (config) => {\n    const animate = keyframes\n      .filter(keyframe => keyframe !== 0)\n      .map((keyframe, i, filtredKeyframes) =>\n        getKeyframeSequenceItems(definition, keyframe, filtredKeyframes[i - 1] ?? 0)\n      )\n      .reduce((acc, keyframeSequenceItems) => {\n        definitionProperties.forEach(property => {\n          const sequenceItem = keyframeSequenceItems[property]\n          if (sequenceItem == null) return\n\n          sequenceItem.duration *= config?.duration ?? DEFAULT_DURATION\n\n          if (acc[property] != null) {\n            acc[property] = [acc[property], sequenceItem].flat()\n            return\n          }\n\n          if (config?.delay != null) {\n            sequenceItem.delay = config.delay\n          }\n\n          acc[property] = sequenceItem\n        })\n        return acc\n      }, {}) as MotifiableProps['animate']\n\n    const result: MotifiableProps = {\n      from,\n      animate,\n      transition: {}\n    }\n\n    if (config?.repeat != null) {\n      result.transition.repeat = config.repeat\n    }\n\n    if (definition.easing != null) {\n      result.transition.easing = definition.easing\n    }\n\n    if (definition.style != null) {\n      result.style = definition.style\n    }\n\n    return result\n  }\n}\nconst cache = new Map<MotifiableDefinition, MotifiableBuilder>()\n\nexport const compileAnimation = (definition: MotifiableDefinition): MotifiableBuilder => {\n  const cachedBuilder = cache.get(definition)\n\n  if (cachedBuilder != null) {\n    return cachedBuilder\n  }\n\n  const builder = compile(definition)\n  cache.set(definition, builder)\n\n  return builder\n}\n"]}