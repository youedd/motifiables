{"version":3,"sources":["compile.ts"],"names":["Keyframe","compareNumbers","notNull","parsePosition","DEFAULT_DURATION","compile","definition","keyframes","Object","keys","map","filter","length","Error","sort","getDefinitionKeyframeStyles","getStyles","definitionKeyframesStyles","definitionProperties","getStylesProperties","from","config","animate","_","keyframeIndex","getSequenceItems","reduce","acc","keyframeSequenceItems","forEach","property","sequenceItem","duration","delay","easing","flat","result","repeat","transition","cache","Map","compileAnimation","cachedBuilder","get","builder","set"],"mappings":"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","sourcesContent":["import { MotifiableDefinition } from '../definitions'\nimport * as Keyframe from './keyframe'\nimport { MotifiableBuilder, MotifiableProps } from './types'\nimport { compareNumbers, notNull, parsePosition } from './utils'\n\nconst DEFAULT_DURATION = 1000\n\nconst compile = (definition: MotifiableDefinition): MotifiableBuilder => {\n  const keyframes = Object.keys(definition)\n    .map(parsePosition)\n    .filter(notNull) as number[]\n\n  if (keyframes.length < 2) {\n    throw new Error('Animation definitions must have at least two values.')\n  }\n\n  keyframes.sort(compareNumbers)\n\n  const getDefinitionKeyframeStyles = Keyframe.getStyles(definition)\n\n  const definitionKeyframesStyles = keyframes.map(getDefinitionKeyframeStyles)\n  const definitionProperties = Keyframe.getStylesProperties(definitionKeyframesStyles)\n\n  const from = getDefinitionKeyframeStyles(0) as MotifiableProps['from']\n\n  return (config) => {\n    const animate = keyframes\n      .map((_, keyframeIndex) =>\n        Keyframe.getSequenceItems(definition, keyframeIndex, keyframes)\n      )\n      .reduce((acc, keyframeSequenceItems) => {\n        definitionProperties.forEach(property => {\n          const sequenceItem = keyframeSequenceItems[property]\n\n          if (sequenceItem == null) {\n            return\n          }\n\n          sequenceItem.duration *= config?.duration ?? DEFAULT_DURATION\n\n          if (acc[property] == null) {\n            acc[property] = [sequenceItem]\n            return\n          }\n\n          if (acc[property]?.length === 1 && config?.delay != null) {\n            sequenceItem.delay = config.delay\n          }\n\n          if (definition.easing != null) {\n            sequenceItem.easing = definition.easing\n          }\n\n          acc[property] = [acc[property], sequenceItem].flat()\n        })\n        return acc\n      }, {}) as MotifiableProps['animate']\n\n    const result: MotifiableProps = {\n      from,\n      animate\n    }\n\n    if (config?.repeat != null) {\n      result.transition = { repeat: config.repeat }\n    }\n\n    return result\n  }\n}\nconst cache = new Map<MotifiableDefinition, MotifiableBuilder>()\n\nexport const compileAnimation = (definition: MotifiableDefinition): MotifiableBuilder => {\n  if (definition == null) {\n    throw new Error('Animation definitions must be defined')\n  }\n\n  const cachedBuilder = cache.get(definition)\n\n  if (cachedBuilder != null) {\n    return cachedBuilder\n  }\n\n  const builder = compile(definition)\n  cache.set(definition, builder)\n\n  return builder\n}\n"]}