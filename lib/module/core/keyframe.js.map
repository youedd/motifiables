{"version":3,"sources":["keyframe.ts"],"names":["_getStyles","definition","position","from","to","_getStylesProperties","keyframeStyles","Object","keys","_getPropertyPreviousKeyframe","property","currentKeyframeIndex","keyframes","i","keyframe","styles","getStyles","Error","getStylesProperties","keyframesStyles","Set","map","flat","getSequenceItems","keyframeIndex","keyFrames","properties","reduce","acc","previousKeyframe","value","type","duration"],"mappings":"AAEA,MAAMA,UAAU,GAAG,CAACC,UAAD,EAAmCC,QAAnC,KAAwF;AACzG,MAAID,UAAU,IAAI,IAAlB,EAAwB;AACtB,WAAO,IAAP;AACD;;AACD,MAAIA,UAAU,CAACC,QAAD,CAAV,IAAwB,IAA5B,EAAkC,OAAOD,UAAU,CAACC,QAAD,CAAjB;AAElC,MAAIA,QAAQ,KAAK,CAAb,IAAkBD,UAAU,CAACE,IAAX,IAAmB,IAAzC,EAA+C,OAAOF,UAAU,CAACE,IAAlB;AAE/C,MAAID,QAAQ,KAAK,CAAb,IAAkBD,UAAU,CAACG,EAAX,IAAiB,IAAvC,EAA6C,OAAOH,UAAU,CAACG,EAAlB;AAE7C,SAAO,IAAP;AACD,CAXD;;AAaA,MAAMC,oBAAoB,GAAIC,cAAD,IAA2D;AACtF,SAAOC,MAAM,CAACC,IAAP,CAAYF,cAAZ,CAAP;AACD,CAFD;;AAIA,MAAMG,4BAA4B,GAAG,CACnCR,UADmC,EAEnCS,QAFmC,EAGnCC,oBAHmC,EAInCC,SAJmC,KAKxB;AACX,OAAK,IAAIC,CAAC,GAAGF,oBAAoB,GAAG,CAApC,EAAuCE,CAAC,GAAG,CAA3C,EAA8CA,CAAC,EAA/C,EAAmD;AACjD,UAAMC,QAAQ,GAAGF,SAAS,CAACC,CAAD,CAA1B;;AACA,UAAME,MAAM,GAAGf,UAAU,CAACC,UAAD,EAAaa,QAAb,CAAzB;;AAEA,QAAI,CAAAC,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAGL,QAAH,CAAN,KAAsB,IAA1B,EAAgC;AAC9B,aAAOI,QAAP;AACD;AACF;;AAED,SAAO,CAAP;AACD,CAhBD;;AAkBA,OAAO,MAAME,SAAS,GAAIf,UAAD,IAAuCC,QAAD,IAAmC;AAChG,QAAMY,QAAQ,GAAGd,UAAU,CAACC,UAAD,EAAaC,QAAb,CAA3B;;AAEA,MAAIY,QAAQ,IAAI,IAAhB,EAAsB,OAAOA,QAAP;AAEtB,QAAM,IAAIG,KAAJ,CAAU,oDAAV,CAAN;AACD,CANM;AAQP,OAAO,MAAMC,mBAAmB,GAAIC,eAAD,IAA8D;AAC/F,SAAO,CAAC,GAAG,IAAIC,GAAJ,CAAQD,eAAe,CAACE,GAAhB,CAAoBhB,oBAApB,EAA0CiB,IAA1C,EAAR,CAAJ,CAAP;AACD,CAFM;AAIP,OAAO,MAAMC,gBAAgB,GAAG,CAC9BtB,UAD8B,EAE9BuB,aAF8B,EAG9BC,SAH8B,KAGmD;AACjF,QAAMX,QAAQ,GAAGW,SAAS,CAACD,aAAD,CAA1B;AACA,QAAMlB,cAAc,GAAGU,SAAS,CAACf,UAAD,CAAT,CAAsBa,QAAtB,CAAvB;;AAEA,QAAMY,UAAU,GAAGrB,oBAAoB,CAACC,cAAD,CAAvC;;AAEA,SAAOoB,UAAU,CAACC,MAAX,CAAkB,CAACC,GAAD,EAAMlB,QAAN,KAAmB;AAC1C,UAAMmB,gBAAgB,GAAGpB,4BAA4B,CAACR,UAAD,EAAaS,QAAb,EAAuBc,aAAvB,EAAsCC,SAAtC,CAArD;;AACA,WAAO,EACL,GAAGG,GADE;AAEL,OAAClB,QAAD,GAAY;AACVoB,QAAAA,KAAK,EAAExB,cAAc,CAACI,QAAD,CADX;AAEVqB,QAAAA,IAAI,EAAE,QAFI;AAGVC,QAAAA,QAAQ,EAAElB,QAAQ,GAAGe;AAHX;AAFP,KAAP;AAQD,GAVM,EAUJ,EAVI,CAAP;AAWD,CApBM","sourcesContent":["import { MotifiableDefinition, StyleValues } from '../definitions'\n\nconst _getStyles = (definition: MotifiableDefinition, position: number): StyleValues | undefined | null => {\n  if (definition == null) {\n    return null\n  }\n  if (definition[position] != null) return definition[position]\n\n  if (position === 0 && definition.from != null) return definition.from\n\n  if (position === 1 && definition.to != null) return definition.to\n\n  return null\n}\n\nconst _getStylesProperties = (keyframeStyles: StyleValues): Array<keyof StyleValues> => {\n  return Object.keys(keyframeStyles) as Array<keyof StyleValues>\n}\n\nconst _getPropertyPreviousKeyframe = (\n  definition: MotifiableDefinition,\n  property: keyof StyleValues,\n  currentKeyframeIndex: number,\n  keyframes: number[]\n): number => {\n  for (let i = currentKeyframeIndex - 1; i > 0; i--) {\n    const keyframe = keyframes[i]\n    const styles = _getStyles(definition, keyframe)\n\n    if (styles?.[property] != null) {\n      return keyframe\n    }\n  }\n\n  return 0\n}\n\nexport const getStyles = (definition: MotifiableDefinition) => (position: number): StyleValues => {\n  const keyframe = _getStyles(definition, position)\n\n  if (keyframe != null) return keyframe\n\n  throw new Error('Missing animation keyframe, this should not happen')\n}\n\nexport const getStylesProperties = (keyframesStyles: StyleValues[]): Array<keyof StyleValues> => {\n  return [...new Set(keyframesStyles.map(_getStylesProperties).flat())]\n}\n\nexport const getSequenceItems = (\n  definition: MotifiableDefinition,\n  keyframeIndex: number,\n  keyFrames: number[]): Partial<Record<keyof StyleValues, Record<string, any>>> => {\n  const keyframe = keyFrames[keyframeIndex]\n  const keyframeStyles = getStyles(definition)(keyframe)\n\n  const properties = _getStylesProperties(keyframeStyles)\n\n  return properties.reduce((acc, property) => {\n    const previousKeyframe = _getPropertyPreviousKeyframe(definition, property, keyframeIndex, keyFrames)\n    return {\n      ...acc,\n      [property]: {\n        value: keyframeStyles[property],\n        type: 'timing',\n        duration: keyframe - previousKeyframe\n      }\n    }\n  }, {})\n}\n"]}